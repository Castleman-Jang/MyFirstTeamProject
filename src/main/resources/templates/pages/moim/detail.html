<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}" lang="ko">
<body>
<main class="main-wrapper" layout:fragment="content">
    <div class="main-anchor-container">
        <div class="main-container">
            <!--모임메인사진-->
            <img
                    th:src="@{https://kr.object.iwinv.kr/moida/{path}(path=${moim.fileConvert})}"
                    alt="모임메인사진" class="moim-main-image">
            <!--모바일 버전 모임 제목, 설명, 신청버튼-->
            <div class="moim-title-mobile" th:text="${moim.moimTitle}"></div>
            <div class="moim-description-mobile">
                <i class="ti ti-calendar-week"></i>[[${moimAddress1}]]&nbsp;[[${moimDate}]]
            </div>
            <div class="moim-fee-mobile">
                참가비
                <div class="moim-fee-2-mobile" th:text="${moim.moimMoney}">원</div>
            </div>
            <hr class="moim-enroll-divider-mobile"/>
            <div id="moim-enroll-buttonBox-mobile" class="moim-enroll-buttonBox">
                <button data-context="detail" th:data-moim-id="${moim.moimId}"
                        th:onclick="@{|createMoimAttendee(${moim.moimId})|}">신청하기
                </button>
            </div>

            <div class="review-content">
                <div class="reviewTitle">참여자 후기</div>
                <hr class="moimReview-divider">
                <button class="review-read-btn"
                        onclick="location.href='/review/detail'">리뷰 상세보기
                </button>
            </div>
            <div class="review-container">
                <!--모임 후기 섹션 : 클릭 시 모달창으로 후기상세내용 보이기-->
                <div class="review-item" th:each="r : ${reviewList}">
                    <img
                            src="https://media.bunjang.co.kr/product/283006372_1_1722771500_w360.jpg"
                            alt="후기1" class="profile-img">
                    <div class="review-text">
                        <div class="review-writer">[[${r.username}]]</div>
                        <div class="user-star">
                            <i class="ti ti-carambola"></i> <i class="ti ti-carambola"></i> <i
                                class="ti ti-carambola"></i> <i class="ti ti-carambola"></i> <i
                                class="ti ti-carambola"></i>
                        </div>
                        <div class="review">
                            <p class="reviewText">
                                <span> [[${r.reviewContent}]] </span>
                                <button class="more-btn" onclick="openModal(this)">더보기</button>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!--review container-->

            <div class="moim-detail-title">
                상세정보
                <hr class="moimInfo-divider">
            </div>
            <div class="main-moimInfo">
                <div class="moimInfo-container">
                    <div class="moimInfo-title">
                        <div class="moimInfo">
                            <p id="content">[[${moimContent}]]</p>
                        </div>
                    </div>
                    <button class="moreInfo" id="moreInfo">더보기</button>
                </div>
            </div>
            <!--moimInfo-->
            <div class="host-intro">호스트 소개</div>
            <div class="host-intro-2">앞으로 함께할 호스트에요</div>
            <div class="host-container">
                <div class="host-profile-img">
                    <img src="./hostPrifile01.jpg" alt="호스트 프로필 사진">
                </div>
                <div class="host-info-container">
                    <div class="host-name">[[${name}]]</div>
                    <div class="host-introduction">[[${hostIntro}]]</div>
                </div>
                <div class="host-moimImg">
                    <!--모임관련 대문사진 제외한 나머지 사진이 들어갑니다.-->
                </div>
            </div>

            <!-- 문의창 -->
            <section class="question-section py-5" style="margin-top: 80px;">
                <div class="container question-container-wide">

                    <!-- 문의 작성 폼 -->
                    <form class="question-form shadow-sm" action="/moim/question"
                          method="POST">
                        <h5 class="section-title">문의하기</h5>

                        <input type="hidden" name="moimId" th:value="${moim.moimId}"/>

                        <div class="form-group mb-3">
                            <label for="questionContent" class="form-label">문의 내용</label>

                            <hr>

                            <textarea id="questionContent" name="quesContent"
                                      class="form-control" rows="4" placeholder="문의 내용을 입력하세요..."
                                      style="width: 620px; height: 82px;"></textarea>
                        </div>


                        <div class="text-end">
                            <div th:if="${loginUser == null}">
                                <p>
                                    문의하려면 <a href="/login">로그인</a> 해주세요.
                                </p>
                            </div>
                            <button type="submit" class="btn btn-submit"
                                    th:if="${loginUser != null}">문의 등록
                            </button>
                        </div>
                    </form>

                    <!-- 문의 완료 카드 -->
                    <div th:each="question : ${questions}"
                         class="question-result shadow-sm mt-4">
                        <h6 class="section-subtitle">문의 내용</h6>
                        <p class="text-muted mb-1">
                            문의 유저ID: <span th:text="${question.questionUserId}"></span>
                        </p>
                        <p class="mb-4" th:text="${question.quesContent}"></p>

                        <br>

                        <!-- 호스트이고 + 답변이 없을 경우에만 답변 입력폼 표시 -->
                        <div
                                th:if="${loginUser != null and moim.userId == loginUser.userId and question.ansContent == null}">
                            <form class="answer-form" action="/moim/answer" method="POST">
                                <input type="hidden" name="quesId" th:value="${question.quesId}"/>
                                <input type="hidden" name="answerUserId"
                                       th:value="${loginUser.userId}"/> <input type="hidden"
                                                                               name="moimId" th:value="${moim.moimId}"/>
                                <textarea th:id="'ansContent-' + ${question.quesId}"
                                          name="ansContent" class="form-control mb-2" rows="3"
                                          placeholder="답변을 입력하세요..." style="width: 620px; height: 82px;"></textarea>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-answer">답변 등록</button>
                                </div>
                            </form>
                        </div>

                        <!-- 답변이 있을 경우 출력 -->
                        <div th:if="${question.ansContent} != null"
                             class="answer-result mt-3 p-3">
                            <h6 class="section-subtitle">답변</h6>
                            <p class="text-muted mb-1">
                                답변 작성자 ID: <span th:text="${question.answerUserId}"></span>
                            </p>
                            <p class="mb-0" th:text="${question.ansContent}"></p>
                        </div>
                    </div>

                </div>
            </section>


        </div>


        <div class="main-container2">
            <!--모임 신청칸 pc-->
            <div class="main-enroll-pc">
                <button class="moim-category" type="button">[[${categoryName}]]</button>
                <!--카테고리-->
                <div class="moim-title">[[${moimTitle}]]</div>
                <div class="moim-description">
                    <div class="moim-arrange">
                        <i class="ti ti-calendar-week"></i>[[${moimAddress1}]]&nbsp;[[${moimAddress2}]]&nbsp;[[${moimDate}]]
                    </div>
                    <div class="moim-fee">
                        참가비
                        <div class="moim-fee-2">[[${moimMoney}]]</div>
                    </div>
                    <hr class="moim-enroll-divider"/>
                </div>

                <div id="moim-enroll-buttonBox-pc" class="moim-enroll-buttonBox">
                    <button type="button" class="enroll-button-pc"
                            data-context="detail" th:data-moim-id="${moim.moimId}"
                            th:onclick="@{|createMoimAttendee(${moim.moimId})|}">신청하기
                    </button>
                </div>


            </div>
        </div>
        <!--리뷰 상세 : 모달창 띄우기-->
        <div class="modal-backdrop" onclick="closeModal()"
             style="display: none;"></div>
        <div class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close" onclick="closeModal()"></span>
                <p id="reviewText"></p>
            </div>
        </div>

    </div>
</main>
<div id="joinMoimModal" class="modal" style="display: none;">
    <div class="modal-content">
        <p>신청하시겠습니까?</p>
        <button id="joinMoimYes">예</button>
        <button id="joinMoimNo">아니오</button>
    </div>
</div>

<div class="backdrop" onclick="hideBackdrop()"></div>

</body>

</html>